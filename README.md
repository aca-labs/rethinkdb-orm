# RethinkDB ORM for Crystal Lang

[![Build Status](https://travis-ci.org/aca-labs/rethinkdb-orm.svg?branch=master)](https://travis-ci.org/aca-labs/rethinkdb-orm)

Extending [ActiveModel](https://github.com/spider-gazelle/active-model) for attribute definitions and validations

## Changefeeds

In progress...

## Callbacks

Register callbacks for `save`, `update`, `create` and `destroy` by setting the corresponding before/after callback handler.

```ruby
class ModelWithCallbacks < RethinkORM::Base
  attribute address : String
  attribute age : Int32 = 10

  before_create :set_address
  after_update :set_age
  before_destroy do
    self.name = "joe"
  end

  def set_address
    self.address = "23"
  end

  def set_age
    self.age = 30
  end
end
```

## Associations

Set associations with belongs_to and has_many.

Access children in parent by accessing the method correpsonding to the pluralised child.
Children collection method name is generated by dumb pluralisation (appending an s).
Optionally set children collection name in `has_many` by setting `plural` param.

```ruby
class Parent < RethinkORM::Base
  attribute name : String
  has_many Child, plural: "Children"
end

class Child < RethinkORM::Base
  attribute age : Int32
  belongs_to Parent
  has_many Pet
end

class Pet < RethinkORM::Base
  attribute name : String
  belongs_to Child
end

parent = Parent.new(name: "Phil")
parent.children.empty? # => true

child = Child.new(age: 99)
child.pets.empty? # => true
```